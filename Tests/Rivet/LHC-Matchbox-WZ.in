##################################################
# Rivet analyses at the Z pole
##################################################
read LHCBase-Matchbox.in

cd /Herwig/MatrixElements/Matchbox/Amplitudes

##################################################
## Generic Procsses
##################################################

## Enable generic processes
clear /Herwig/MatrixElements/Matchbox/PPFactory:Amplitudes
insert /Herwig/MatrixElements/Matchbox/PPFactory:Amplitudes 0 GenericProcesses
set GenericProcesses:TreeLevelAmplitude MadGraph
set GenericProcesses:OneLoopAmplitude OpenLoops

## Set the order of the couplings
cd /Herwig/MatrixElements/Matchbox
set PPFactory:OrderInAlphaS 0
set PPFactory:OrderInAlphaEW 2

## Select the process
## You may use identifiers such as p, pbar, j, l, mu+, h0 etc.
do PPFactory:Process p p W+ Z0
do PPFactory:Process p p W- Z0

## Scale choice
set /Herwig/MatrixElements/Matchbox/Scales/FixedScale:FixedScale 171.6*GeV
set PPFactory:ScaleChoice /Herwig/MatrixElements/Matchbox/Scales/FixedScale

do /Herwig/Particles/W+:SelectDecayModes /Herwig/Particles/W+/W+->nu_e,e+; /Herwig/Particles/W+/W+->nu_mu,mu+;
do /Herwig/Particles/W-:SelectDecayModes /Herwig/Particles/W-/W-->nu_ebar,e-; /Herwig/Particles/W-/W-->nu_mubar,mu-;
do /Herwig/Particles/Z0:SelectDecayModes /Herwig/Particles/Z0/Z0->e-,e+; /Herwig/Particles/Z0/Z0->mu-,mu+;

##################################################
## Cut Selection
##################################################

## For finite calculations make resonable cuts! Check the wiki and manual
## for other cut options and different jet algorithms.
cd /Herwig/Cuts

set MatchboxJetMatcher:Factory /Herwig/MatrixElements/Matchbox/PPFactory

## Cut on lepton pair invariant mass
set MassCut:MinM 66*GeV
set MassCut:MaxM 116*GeV

# reweight for the branching ratios
create Herwig::BranchingRatioReweighter /Herwig/Generators/BRReweighter
insert /Herwig/EventHandlers/LHCHandler:PostHadronizationHandlers 0 /Herwig/Generators/BRReweighter

##################################################
# select the analyses
##################################################

# general analysis
insert /Herwig/Analysis/RivetAnalysis:Analyses 0 ATLAS_2011_I954993

##################################################
# Save run for later usage with 'Herwig++ run'
##################################################
cd /Herwig/Generators
saverun LHC-Matchbox-WZ LHCGenerator
