###################################################
# Rivet analyses at the Z pole
##################################################
read LHCBase-Matchbox.in

cd /Herwig/MatrixElements/Matchbox/Amplitudes

set /Herwig/Particles/t:HardProcessWidth 0.*GeV
set /Herwig/Particles/tbar:HardProcessWidth 0.*GeV

# Enable generic processes
clear /Herwig/MatrixElements/Matchbox/PPFactory:Amplitudes
insert /Herwig/MatrixElements/Matchbox/PPFactory:Amplitudes 0 GenericProcesses
set GenericProcesses:TreeLevelAmplitude MadGraph
set GenericProcesses:OneLoopAmplitude OpenLoops

## Set the order of the couplings
cd /Herwig/MatrixElements/Matchbox
set PPFactory:OrderInAlphaS 2
set PPFactory:OrderInAlphaEW 0

## Select the process
## You may use identifiers such as p, pbar, j, l, mu+, h0 etc.
do PPFactory:Process p p t tbar

## Scale choice
set PPFactory:ScaleChoice /Herwig/MatrixElements/Matchbox/Scales/TopMTScale

# select semileptonic
set /Herwig/Particles/t:Synchronized Not_synchronized
set /Herwig/Particles/tbar:Synchronized Not_synchronized
do /Herwig/Particles/t:SelectDecayModes t->nu_e,e+,b; t->nu_mu,mu+,b;
do /Herwig/Particles/tbar:SelectDecayModes tbar->b,bbar,cbar; tbar->bbar,cbar,d; tbar->bbar,cbar,s; tbar->bbar,s,ubar; tbar->bbar,ubar,d;

create Herwig::BranchingRatioReweighter /Herwig/Generators/BRReweighter
insert /Herwig/EventHandlers/LHCHandler:PostHadronizationHandlers 0 /Herwig/Generators/BRReweighter


##################################################
# select the analyses
##################################################

# MC analysis
insert /Herwig/Analysis/RivetAnalysis:Analyses 0 MC_TTBAR
# ATLAS b-jet shapes in top events
insert /Herwig/Analysis/RivetAnalysis:Analyses 0 ATLAS_2013_I1243871
insert /Herwig/Analysis/RivetAnalysis:Analyses 0 ATLAS_2014_I1304688
##################################################
# Save run for later usage with 'Herwig++ run'
##################################################
cd /Herwig/Generators
saverun LHC-Matchbox-7-Top-SL LHCGenerator
