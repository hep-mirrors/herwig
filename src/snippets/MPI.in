##################################################
# MEMinBias Matrix Element
##################################################
# MPI model settings
set /Herwig/UnderlyingEvent/MPIHandler:IdenticalToUE 0

## Report the correct cross section
cd /Herwig/Generators
create Herwig::MPIXSecReweighter MPIXSecReweighter
insert EventGenerator:EventHandler:PostSubProcessHandlers 0 MPIXSecReweighter
set EventGenerator:EventHandler:CascadeHandler NULL

clear EventGenerator:EventHandler:SubProcessHandlers[0]

##################################################
# Create separate SubProcessHandler for MinBias
##################################################
cd /Herwig/MatrixElements/
cp SubProcess QCDMinBias

set QCDMinBias:CascadeHandler /Herwig/Shower/ShowerHandler
set QCDMinBias:CascadeHandler:MPIHandler /Herwig/UnderlyingEvent/MPIHandler
set QCDMinBias:DecayHandler /Herwig/Decays/DecayHandler

insert QCDMinBias:MatrixElements[0] MEMinBias

cd /Herwig/Generators
# MinBias parameters used for the new kinematics of soft MPI
set /Herwig/Cuts/MinBiasCuts:X1Min 0.11
set /Herwig/Cuts/MinBiasCuts:X2Min 0.11

# Needed to get the correct fraction of diffractive events
set /Herwig/MatrixElements/MEMinBias:csNorm 4.5584

set EventGenerator:EventHandler:Cuts /Herwig/Cuts/MinBiasCuts

set /Herwig/Partons/RemnantDecayer:colourDisrupt 0.0
set /Herwig/Hadronization/ColourReconnector:ColourReconnection Yes
# Use multiperipheral kinematics
set /Herwig/Partons/RemnantDecayer:MultiPeriph Yes
# Set ladder multiplicity factor
set /Herwig/Partons/RemnantDecayer:ladderbFactor 0.0
# Set gaussian width of longitudinal momentum fraction
# flucutuation
set /Herwig/Partons/RemnantDecayer:gaussWidth 0.03

# Tuned to min-bias data
set /Herwig/Hadronization/ColourReconnector:ReconnectionProbability 0.677921
set /Herwig/UnderlyingEvent/MPIHandler:pTmin0 3.068890
set /Herwig/UnderlyingEvent/MPIHandler:InvRadius 1.386754 
set /Herwig/UnderlyingEvent/MPIHandler:Power 0.709107
set /Herwig/Partons/RemnantDecayer:ladderPower -0.367906
set /Herwig/Partons/RemnantDecayer:ladderNorm 1.022621


cd /Herwig/MatrixElements/
insert /Herwig/Generators/EventGenerator:EventHandler:SubProcessHandlers[0] QCDMinBias
