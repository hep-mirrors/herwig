##################################################
# MEMinBias Matrix Element
##################################################

# MPI model settings
set /Herwig/UnderlyingEvent/MPIHandler:IdenticalToUE 0

## Report the correct cross section
cd /Herwig/Generators

# TODO: remove the MPIXSecReweighter once validated. 
#create Herwig::MPIXSecReweighter MPIXSecReweighter
#insert EventGenerator:EventHandler:PostSubProcessHandlers 0 MPIXSecReweighter


set EventGenerator:EventHandler:CascadeHandler NULL

clear EventGenerator:EventHandler:SubProcessHandlers[0]

##################################################
# Create separate SubProcessHandler for MinBias
##################################################
cd /Herwig/MatrixElements/
cp SubProcess QCDMinBias

set QCDMinBias:CascadeHandler /Herwig/Shower/ShowerHandler
set QCDMinBias:CascadeHandler:MPIHandler /Herwig/UnderlyingEvent/MPIHandler
set QCDMinBias:DecayHandler /Herwig/Decays/DecayHandler

# Due to numerics the pomeron could be seen as timelike.
set /Herwig/Shower/ShowerHandler:SplitHardProcess No
set /Herwig/DipoleShower/DipoleShowerHandler:SplitHardProcess No

insert QCDMinBias:MatrixElements[0] MEMinBias

# MEMinBias is automatically reweighted to give the cross section 
# comunicated by the MPIHandler.
set MEMinBias:MPIHandler /Herwig/UnderlyingEvent/MPIHandler

cd /Herwig/Generators
# MinBias parameters used for the new kinematics of soft MPI
set /Herwig/Cuts/MinBiasCuts:X1Min 0.011
set /Herwig/Cuts/MinBiasCuts:X2Min 0.011


#PDFs for MPI,Underlying Event, Min Bias
# set the correct PDFs

set /Herwig/Partons/HardLOPDF:PDFName CT14lo
set /Herwig/Partons/ShowerLOPDF:PDFName CT14lo
set /Herwig/Partons/MPIPDF:PDFName CT14lo
set /Herwig/Partons/RemnantPDF:PDFName CT14lo


# Needed to get the correct fraction of diffractive events
set /Herwig/MatrixElements/MEMinBias:csNorm 0.01

set /Herwig/MatrixElements/MEMinBias:Scale 2.0

set EventGenerator:EventHandler:Cuts /Herwig/Cuts/MinBiasCuts

cd /Herwig/MatrixElements/
insert /Herwig/Generators/EventGenerator:EventHandler:SubProcessHandlers[0] QCDMinBias
