cd /Herwig/Merging

# Setting up to use the merging factory instead of the Matchbox Factory
clear /Herwig/EventHandlers/EventHandler:SubProcessHandlers
insert /Herwig/EventHandlers/EventHandler:SubProcessHandlers[0] MergingFactory
set /Herwig/Cuts/MatchboxJetMatcher:Factory MergingFactory
set /Herwig/MatrixElements/Matchbox/MECorrectionHandler:Factory MergingFactory
set MergingFactory:Cuts /Herwig/Cuts/Cuts
set Merger:MergingFactory MergingFactory
set Merger:DipoleShowerHandler /Herwig/DipoleShower/DipoleShowerHandler
set /Herwig/DipoleShower/DipoleShowerHandler:MergingHelper Merger
set /Herwig/DipoleShower/DipoleShowerHandler:SplitHardProcess No

set MergingFactory:MergingHelper Merger


### Don't apply restrictions on the z-boundaries while clustering.
set /Herwig/Merging/Merger:OpenInitialStateZ Yes

# Set up the rivet analysis to use.
cd /Herwig/Analysis
create ThePEG::RivetAnalysis Rivet RivetAnalysis.so

# Switch of the profiles of the Shower
set /Herwig/DipoleShower/DipoleShowerHandler:HardScaleProfile NULL

# We switch of the pdfs for e+/e- beams.
# This can be turned on again if needed.
set /Herwig/Particles/e+:PDF /Herwig/Partons/NoPDF
set /Herwig/Particles/e-:PDF /Herwig/Partons/NoPDF

# Set the alpha_s value for the run.
set /Herwig/Couplings/NLOAlphaS:min_active_flavours 3
set /Herwig/Couplings/NLOAlphaS:max_active_flavours 5
set /Herwig/Couplings/NLOAlphaS:input_alpha_s 0.118
set /Herwig/Couplings/NLOAlphaS:input_scale 91.18*GeV
set /Herwig/Model:QCD/RunningAlphaS /Herwig/Couplings/NLOAlphaS
set /Herwig/DipoleShower/DipoleShowerHandler:GlobalAlphaS /Herwig/Couplings/NLOAlphaS



cd /Herwig/Generators
set EventGenerator:EventHandler:CascadeHandler /Herwig/DipoleShower/DipoleShowerHandler

set /Herwig/DipoleShower/DipoleShowerHandler:MaxPtIsMuF Yes



##########################
######
######  Tuning Parameters.
######
##########################


cd /Herwig/Particles

do c:UnsetHardProcessMass
do cbar:UnsetHardProcessMass
set c:NominalMass 0*GeV
set cbar:NominalMass 0*GeV


##################################################
## intrinsic pt
##################################################
set /Herwig/DipoleShower/IntrinsicPtGenerator:ValenceIntrinsicPtScale 2.0*GeV
set /Herwig/DipoleShower/IntrinsicPtGenerator:SeaIntrinsicPtScale 2.0*GeV

##################################################
## Dipole shower tune settings
##################################################

set /Herwig/Particles/g:ConstituentMass 0.7899848*GeV

##################################################
## cutoffs
##################################################
set /Herwig/DipoleShower/Kinematics/FFLightKinematics:IRCutoff 0.45*GeV
set /Herwig/DipoleShower/Kinematics/FFMassiveKinematics:IRCutoff 0.45*GeV

set /Herwig/DipoleShower/Kinematics/FILightKinematics:IRCutoff 0.45*GeV
set /Herwig/DipoleShower/Kinematics/FIMassiveKinematics:IRCutoff 0.45*GeV

set /Herwig/DipoleShower/Kinematics/IFLightKinematics:IRCutoff 0.45*GeV
set /Herwig/DipoleShower/Kinematics/IFMassiveKinematics:IRCutoff 0.45*GeV

set /Herwig/DipoleShower/Kinematics/IILightKinematics:IRCutoff  0.45*GeV

## needs to be synchronized with settings above
set /Herwig/MatrixElements/Matchbox/DipoleMatching:FFPtCut 0.45*GeV
set /Herwig/MatrixElements/Matchbox/DipoleMatching:FIPtCut 0.45*GeV
set /Herwig/MatrixElements/Matchbox/DipoleMatching:IIPtCut 0.45*GeV

##################################################
## hadronization parameters -- complete?
##################################################
cd /Herwig/Hadronization

set ClusterFissioner:ClMaxLight                  3.30
set ClusterFissioner:ClPowLight                  2.50
set ClusterFissioner:PSplitLight                 1.29
set ClusterDecayer:ClDirLight                    1
set ClusterDecayer:ClSmrLight                    3.118342

set ClusterFissioner:ClMaxCharm                  3.11*GeV
set ClusterFissioner:ClPowCharm                  1.62
set ClusterFissioner:PSplitCharm                 2.54
set ClusterDecayer:ClDirCharm                    1
set ClusterDecayer:ClSmrCharm                    0.
set HadronSelector:SingleHadronLimitCharm   0.0

set ClusterFissioner:ClMaxBottom                 1.38*GeV
set ClusterFissioner:ClPowBottom                 0.62
set ClusterFissioner:PSplitBottom                0.20
set ClusterDecayer:ClDirBottom                   1
set ClusterDecayer:ClSmrBottom                   0.
set HadronSelector:SingleHadronLimitBottom  0.12

set HadronSelector:PwtUquark                     1.0
set HadronSelector:PwtDquark                     1.0
set HadronSelector:PwtSquark                     1.09
set HadronSelector:PwtCquark                     1.0
set HadronSelector:PwtBquark                     1.0
set HadronSelector:PwtDIquark                    0.66
set HadronSelector:SngWt                         1.0
set HadronSelector:DecWt                         1.0






####################################
####               Sampler.
####################################





cd /Herwig/Samplers

create Herwig::MonacoSampler Monaco
set /Herwig/Samplers/Sampler:BinSampler Monaco

set Monaco:EnhancementFactor 1.2
set Monaco:InitialPoints 50000
set Monaco:LuminosityMapperBins 8
set Monaco:NIterations 4
set Monaco:RemapChannelDimension Yes
set Monaco:RemapperMinSelection 0.0001
set Monaco:RemapperPoints 100000
set Monaco:UseAllIterations No

set Sampler:UpdateAfter 1000
set Sampler:AddUpSamplers Off
set Sampler:GlobalMaximumWeight Off
set Sampler:FlatSubprocesses Off
set Sampler:MinSelection 0.000001
set Sampler:AlmostUnweighted On
set Sampler:BinSampler:Kappa 1.
set Sampler:RunCombinationData Off
set Sampler:Verbose On

