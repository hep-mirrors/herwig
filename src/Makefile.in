SOURCES := Herwig++.cc

OBJECTS := $(SOURCES:.cc=.o)

PROGS   := Herwig testKtJet

HWLIBS = -lHwHadronization -lHwUtils -lHwDecay -lHwShower -lHwME -lHwWaveFunction -lUA5 -lHwCorrelations -lHwVertex -lHwTVertex -lHwVVertex -lHwSVertex -lHwStandardModel -lHwSMVertex -lHwRSVertex -lHwRSModel -lHwPDT -lHwVMDecay -lHwTMDecay  -lHwSMDecay -lHwWeakCurrent -lHwFormFactor -lHwTauDecay -lHwBaryonDecay -lHwPerturbativeDecay

KTJETPATH = -I***No KtJet path set...won't build KtJet interface***

KTJETLIBS = -lHwKtJet -L***No KtJet path set...won't build KtJet interface***/lib -lKtEvent

.PHONY: Lib

all: LEP testKtJet

.o: .cc
	$(CXX) -c $(CXXFLAGS) $(COMPILER_FLAG) $(CXXDEBUGFLAG) $(CXXOPTFLAG) $(DEFS) $(INCLUDES) $(CXXEXT) $<

include ../Config/Makefile.common

install-local: Herwig++ HerwigDefaults.rpo
	mkdir -p $(INSTALLSHARE)
	if [ ! -z "$(INSTALLSHARE)/PDF" ]; then \
	   mkdir -p $(INSTALLSHARE)/PDF; \
	   cp -r ../PDF/mrst $(INSTALLSHARE)/PDF; \
	fi
	cp LEP.in LEPbb.in LHC.in $(INSTALLSHARE) 
	cp Decays.in Hadronization.in HerwigParticles.in Hw64Decays.in \
	   Shower.in ThePEGParticles.in UnderlyingEvent.in $(INSTALLSHARE)
	sed -e s:../PDF/mrst:$(INSTALLSHARE)/PDF/mrst:g HerwigDefaults.in > $(INSTALLSHARE)/HerwigDefaults.in
	cp HerwigDefaults.rpo $(INSTALLSHARE)
	ln -sfn $(INSTALLLIB) $(PREFIX)/lib/Herwig++/current
	mkdir -p $(INSTALLBIN)
	cp Herwig++ $(INSTALLBIN)
	chmod 755 $(INSTALLBIN)/Herwig++

CXXDEBUGFLAG = -g

check: LEP

lib:

LEP: Herwig++
	export LD_LIBRARY_PATH=$(LD_LIBRARY_PATH):$(RPATH) ; ./Herwig++ init ; ./Herwig++ read LEP.in

Lib:
	cd .. ; $(MAKE) -$(MAKEFLAGS) lib

current: $(PROGS)

$(PROGS): ../Hadronization/libHwHadronization.so ../Utilities/libHwUtils.so \
	../Shower/libHwShower.so ../MatrixElement/libHwME.so \
	../Decay/libHwDecay.so

Herwig++: Herwig++.o
	$(CXX) $(CXXEXT) $(LINKFLAGS) $(CXXDEBUGFLAG) -o $@ $< -L$(SRCDIR)/lib $(HWLIBS) $(LIBS)

testKtJet: testKtJet.o
	$(CXX) $(CXXEXT) $(LINKFLAGS) $(CXXDEBUGFLAG) -o $@ $< -L$(SRCDIR)/lib $(HWLIBS) $(LIBS) $(KTJETLIBS)

testKtJet.o: testKtJet.cc
	$(CXX) -c $(CXXFLAGS) $(COMPILER_FLAG) $(CXXDEBUGFLAG) $(CXXOPTFLAG) $(DEFS) $(INCLUDES) $(CXXEXT) $(KTJETPATH) $<  

HerwigDefaults.rpo: HerwigDefaults.in Herwig++
	export LD_LIBRARY_PATH=$(LD_LIBRARY_PATH):$(RPATH) ; ./Herwig++ init 
